<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Money Manager — Local</title>

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- SheetJS -->
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
:root{
  --accent1:#6C63FF; --accent2:#00D4FF; --bg:#f5f7ff; --card:#ffffff; --muted:#6b7280;
  --success:#10b981; --danger:#ef4444; --radius:12px; --shadow: 0 10px 30px rgba(16,24,40,0.08);
}
[data-theme="dark"]{
  --bg:#071025; --card:#081827; --muted:#9aa4bf;
}
*{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
html,body{height:100%;margin:0;background:var(--bg);color:#0b1220}
.container{
  max-width:1200px;
  margin:24px auto;
  display:grid;
  grid-template-columns:360px 1fr;
  gap:20px;
  padding:0 16px;
}
.card{background:var(--card);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow)}
.logo{display:flex;gap:12px;align-items:center}
.mark{width:46px;height:46px;border-radius:10px;background:linear-gradient(135deg,var(--accent1),var(--accent2));display:flex;align-items:center;justify-content:center;color:white;font-weight:700}
h1,h2,h3{margin:0}
.small{font-size:13px;color:var(--muted)}
input,select,textarea{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);margin-top:8px;max-width:100%;}
button{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:white;border:0;padding:10px 12px;border-radius:10px;cursor:pointer;white-space:nowrap;}
button.ghost{background:transparent;border:1px solid rgba(0,0,0,0.06);color:var(--muted)}
.flex{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.tx{display:flex;justify-content:space-between;padding:10px;border-radius:10px;border:1px solid rgba(0,0,0,0.04);margin-bottom:8px;flex-wrap:wrap}
.hidden{display:none}
.avatar{width:56px;height:56px;border-radius:10px;object-fit:cover;border:2px solid rgba(0,0,0,0.06)}
footer{text-align:center;color:var(--muted);margin-top:16px}
.btn-sm{padding:8px 10px;border-radius:8px;font-size:14px}
.grid-2{display:grid;grid-template-columns:1fr 320px;gap:14px}

/* modal */
.modal-back{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:9999}
.modal{background:var(--card);padding:18px;border-radius:12px;box-shadow:var(--shadow);max-width:900px;width:100%;max-height:85vh;overflow:auto}

/* table */
table{width:100%;border-collapse:collapse}
table th, table td{border:1px solid rgba(0,0,0,0.06);padding:6px;font-size:13px}

/* Responsive adjustments */
@media(max-width:980px){
  .container{grid-template-columns:1fr;padding:12px}
  .grid-2{grid-template-columns:1fr; gap:12px;}
  .flex{flex-wrap:wrap;}
  button,input,select{flex:1 1 100%; min-width:0;}
}
@media(max-width:600px){
  #appUI, .card{padding:12px;}
  .tx{flex-direction:column;align-items:flex-start;}
  #balanceAmt{font-size:24px;}
  .logo div{flex-direction:column;}
}
</style>

</head>
<body data-theme="light">

<div class="container">

  <!-- LEFT: Profile + Export/Import -->
  <aside>
    <div class="card" style="margin-bottom:12px">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div class="logo"><div class="mark">MM</div><div><div style="font-weight:700">Money Manager</div><div class="small">Local • Private</div></div></div>
      </div>

      <hr style="margin:12px 0">

      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div class="small">Signed in as</div>
          <div id="curUser" style="font-weight:700">Local User</div>
        </div>
        <div>
          <img id="curAvatar" class="avatar" src="" alt="" style="display:none" />
        </div>
      </div>

      <hr style="margin:10px 0">
      <button id="profileBtn" class="ghost">Edit Profile</button>
      <hr style="margin:10px 0">

      <div class="small">Export / Import (Excel)</div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="exportX" class="btn-sm">Export Excel</button>
        <button id="importX" class="btn-sm ghost">Import Excel</button>
        <input id="importFile" type="file" accept=".xlsx,.xls" style="display:none" />
      </div>

      <div style="margin-top:12px" class="small">Tip: Import shows preview — you can Append or Replace.</div>
    </div>
  </aside>

  <!-- RIGHT: App UI -->
  <main>
    <section class="card" id="appUI">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div class="small">Available Balance</div>
          <div style="font-size:28px;font-weight:700" id="balanceAmt">₹0.00</div>
          <div class="small">Income: <span id="totalIncome">₹0</span> · Expense: <span id="totalExpense">₹0</span> · Invest: <span id="totalInvest">₹0</span></div>
        </div>
        <div style="text-align:right">
          <div class="flex">
            <button id="addIncome" class="btn-sm">+ Income</button>
            <button id="addExpense" class="btn-sm ghost">- Expense</button>
            <button id="addInvest" class="btn-sm ghost">☆ Invest</button>
          </div>
          <div style="margin-top:8px" class="flex">
            <label class="small">Hide balance <input type="checkbox" id="hideBalance"></label>
            <select id="themeSwitch" style="padding:8px;border-radius:8px;margin-left:8px">
              <option value="light">Light</option>
              <option value="dark">Dark</option>
            </select>
          </div>
        </div>
      </div>

      <hr style="margin:12px 0">
      <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
        <input id="search" placeholder="Search category or note" />
        <select id="filterType">
          <option value="all">All</option>
          <option value="income">Income</option>
          <option value="expense">Expense</option>
          <option value="investment">Investment</option>
        </select>
        <input type="month" id="filterMonth" />
        <button id="clearFilters" class="ghost">Clear</button>
      </div>

      <div id="txList" style="margin-top:12px"></div>
    </section>

    <div style="height:12px"></div>
    <div class="grid-2">
      <div class="card">
        <h3 style="margin-top:0">Recent transactions</h3>
        <div id="recentList" class="small">No items</div>
      </div>

      <div class="card">
        <h3 style="margin-top:0">Charts</h3>
        <canvas id="pieChart"></canvas>
        <div style="height:12px"></div>
        <canvas id="lineChart"></canvas>
      </div>
    </div>

    <div style="height:12px"></div>
    <div class="card">
      <h3 style="margin-top:0">Goals & Budget</h3>
      <div style="display:flex;gap:8px;align-items:center">
        <input id="budgetAmt" placeholder="Monthly budget" />
        <button id="saveBudget" class="ghost">Save</button>
      </div>
      <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
        <input id="goalName" placeholder="Goal name" />
        <input id="goalAmt" placeholder="Target amount" />
        <button id="addGoal" class="ghost">Add</button>
      </div>
      <div id="goalsList" style="margin-top:12px" class="small"></div>

      <div style="margin-top:12px">
        <div class="small">Set App PIN (4 digits)</div>
        <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap">
          <input id="pinInput" maxlength="4" placeholder="PIN" style="width:140px" />
          <button id="setPin" class="ghost">Set / Update</button>
        </div>
      </div>
    </div>
  </main>
</div>

<footer>Built local-only — All user data stored in browser.</footer>
<div id="modalRoot" class="hidden"></div>

<script>
const el=id=>document.getElementById(id);
const uid=()=>Date.now().toString(36)+Math.random().toString(36).slice(2,8);
const fmt=v=>'₹'+Number(v||0).toLocaleString('en-IN',{minimumFractionDigits:2,maximumFractionDigits:2});
let state = JSON.parse(localStorage.getItem('mm_local')) || {profile:{name:'Local User',avatar:null},transactions:[],budget:0,goals:[],pinHash:null,theme:'light'};
let pieChart=null,lineChart=null;

function saveCurrent(){ localStorage.setItem('mm_local',JSON.stringify(state)); renderAll(); }

function openModal(html){ el('modalRoot').innerHTML=`<div class="modal-back" id="modalBack"><div class="modal">${html}</div></div>`; el('modalRoot').classList.remove('hidden'); el('modalBack').addEventListener('click', e=>{if(e.target.id==='modalBack') closeModal();}); }
function closeModal(){ el('modalRoot').innerHTML=''; el('modalRoot').classList.add('hidden'); }

function showProfileSetup(){
  const html=`<h3>Edit profile</h3>
    <label class="small">Display name</label><input id="p_name" value="${state.profile.name||''}" />
    <label class="small">Upload avatar (png/jpg)</label><input id="p_avatar" type="file" />
    <div style="display:flex;gap:8px;margin-top:12px;justify-content:flex-end">
      <button id="p_save" class="btn">Save</button>
      <button id="p_cancel" class="ghost">Cancel</button>
    </div>`;
  openModal(html);
  el('p_save').addEventListener('click',()=>{
    const name=el('p_name').value.trim();
    const file=el('p_avatar').files[0];
    let avatarData=state.profile.avatar||null;
    if(file){
      const reader=new FileReader();
      reader.onload=()=>{avatarData=reader.result; state.profile.name=name; state.profile.avatar=avatarData; saveCurrent(); el('curUser').innerText=name||'Local User'; if(avatarData){el('curAvatar').src=avatarData; el('curAvatar').style.display='block';} closeModal();}
      reader.readAsDataURL(file);
    } else { state.profile.name=name; state.profile.avatar=avatarData; saveCurrent(); el('curUser').innerText=name||'Local User'; closeModal(); }
  });
  el('p_cancel').addEventListener('click',()=>closeModal());
}
el('profileBtn').addEventListener('click',()=>showProfileSetup());

function renderTxList(){
  const list=el('txList'); list.innerHTML='';
  const q=el('search').value.trim().toLowerCase();
  const typeFilter=el('filterType').value;
  const month=el('filterMonth').value;
  const items=(state.transactions||[]).filter(t=>{
    if(typeFilter!=='all'&&t.type!==typeFilter)return false;
    if(month){ const d=new Date(t.date); const m=d.toISOString().slice(0,7); if(m!==month)return false; }
    if(q){ return (t.note||'').toLowerCase().includes(q)||(t.category||'').toLowerCase().includes(q); }
    return true;
  }).slice().reverse();

  if(items.length===0){ list.innerHTML='<div class="small">No transactions</div>'; return; }
  items.forEach(t=>{
    const node=document.createElement('div'); node.className='tx';
    node.innerHTML=`<div style="display:flex;gap:10px;align-items:center"><div style="padding:8px;border-radius:8px;background:rgba(0,0,0,0.03)">${t.type}</div><div><div style="font-weight:700">${t.category||'—'}</div><div class="small">${new Date(t.date).toLocaleString()} ${t.note? '· '+t.note : ''}</div></div></div>
    <div style="text-align:right">
      <div style="font-weight:700;color:${t.type==='expense'? 'var(--danger)' : t.type==='income'? 'var(--success)' : '#111827'}">${t.type==='expense'?'-':''}${fmt(t.amount)}</div>
      <button style="margin-top:4px;color:red" onclick="deleteTx('${t.id}')">Delete</button>
    </div>`;
    list.appendChild(node);
  });
}
function deleteTx(id){ if(!confirm('Delete this transaction?'))return; state.transactions=state.transactions.filter(t=>t.id!==id); saveCurrent(); }

function computeTotals(){ let inc=0,exp=0,inv=0; (state.transactions||[]).forEach(t=>{ if(t.type==='income')inc+=Number(t.amount||0); if(t.type==='expense')exp+=Number(t.amount||0); if(t.type==='investment')inv+=Number(t.amount||0); }); return {inc,exp,inv}; }

function renderRecent(){
  const r=el('recentList'); r.innerHTML='';
  const items=(state.transactions||[]).slice().reverse().slice(0,6);
  if(items.length===0){ r.innerHTML='<div class="small">No recent transactions.</div>'; return; }
  items.forEach(t=>{
    const d=document.createElement('div'); d.className='tx';
    d.innerHTML=`<div><div style="font-weight:700">${t.category||'—'} <span class="small" style="font-weight:400">· ${t.type}</span></div><div class="small">${new Date(t.date).toLocaleString()}</div></div><div style="text-align:right;font-weight:700;color:${t.type==='expense'?'var(--danger)':'var(--success)'}">${t.type==='expense'?'-':''}${fmt(t.amount)}</div>`;
    r.appendChild(d);
  });
}

function renderCharts(){
  const expenses=(state.transactions||[]).filter(t=>t.type==='expense');
  const by={}; expenses.forEach(t=>by[t.category||'Other']=(by[t.category||'Other']||0)+Number(t.amount||0));
  const labels=Object.keys(by), data=Object.values(by);
  if(!pieChart){ pieChart=new Chart(el('pieChart'),{type:'doughnut', data:{labels,datasets:[{data}]}, options:{responsive:true,plugins:{legend:{position:'bottom'}}}});}
  else{ pieChart.data.labels=labels; pieChart.data.datasets[0].data=data; pieChart.update(); }

  const months={}; (state.transactions||[]).forEach(t=>{ const dt=new Date(t.date); const m=dt.getFullYear()+'-'+String(dt.getMonth()+1).padStart(2,'0'); months[m]=months[m]||{income:0,expense:0,investment:0}; months[m][t.type]+=Number(t.amount||0); });
  const ms=Object.keys(months).sort(); const inc=ms.map(m=>months[m].income||0); const exp=ms.map(m=>months[m].expense||0);
  if(!lineChart){ lineChart=new Chart(el('lineChart'),{type:'line',data:{labels:ms,datasets:[{label:'Expense',data:exp,fill:false},{label:'Income',data:inc,fill:false}]},options:{responsive:true}});}
  else{ lineChart.data.labels=ms; lineChart.data.datasets[0].data=exp; lineChart.data.datasets[1].data=inc; lineChart.update();}
}

function renderGoals(){
  const g=el('goalsList'); g.innerHTML='';
  const arr=state.goals||[];
  if(arr.length===0){ g.innerHTML='<div class="small">No goals set</div>'; return;}
  arr.forEach((x,i)=>{ const d=document.createElement('div'); d.className='tx'; d.innerHTML=`<div>${x.name} · ${fmt(x.amount)}</div><button style="color:red" onclick="deleteGoal(${i})">Delete</button>`; g.appendChild(d);});
}
function deleteGoal(i){ state.goals.splice(i,1); saveCurrent(); }

function renderAll(){
  const totals=computeTotals();
  el('totalIncome').innerText=fmt(totals.inc);
  el('totalExpense').innerText=fmt(totals.exp);
  el('totalInvest').innerText=fmt(totals.inv);
  el('balanceAmt').innerText=fmt(totals.inc-totals.exp-totals.inv);
  if(el('hideBalance').checked) el('balanceAmt').innerText='****';
  el('curUser').innerText=state.profile.name||'Local User';
  if(state.profile.avatar){el('curAvatar').src=state.profile.avatar; el('curAvatar').style.display='block';}else el('curAvatar').style.display='none';
  renderTxList(); renderRecent(); renderCharts(); renderGoals();
  el('budgetAmt').value=state.budget||'';
}
renderAll();

el('themeSwitch').value=state.theme||'light';
document.body.setAttribute('data-theme',state.theme||'light');
el('themeSwitch').addEventListener('change',()=>{state.theme=el('themeSwitch').value; document.body.setAttribute('data-theme',state.theme); saveCurrent();});
el('hideBalance').addEventListener('change',()=>renderAll());

function openAddTx(type){
  const html=`<h3>Add ${type}</h3>
    <label>Amount</label><input id="txAmt" type="number" />
    <label>Category</label><input id="txCat" />
    <label>Note (optional)</label><input id="txNote" />
    <div style="display:flex;gap:8px;margin-top:12px;justify-content:flex-end">
      <button id="txSave" class="btn">Save</button>
      <button id="txCancel" class="ghost">Cancel</button>
    </div>`;
  openModal(html);
  el('txSave').addEventListener('click',()=>{
    const amt=Number(el('txAmt').value); if(!amt){alert('Enter valid amount'); return;}
    const cat=el('txCat').value.trim(); const note=el('txNote').value.trim();
    state.transactions.push({id:uid(),type,amount:amt,category:cat,note,date:new Date().toISOString()});
    saveCurrent(); closeModal();
  });
  el('txCancel').addEventListener('click',()=>closeModal());
}
el('addIncome').addEventListener('click',()=>openAddTx('income'));
el('addExpense').addEventListener('click',()=>openAddTx('expense'));
el('addInvest').addEventListener('click',()=>openAddTx('investment'));

el('search').addEventListener('input',()=>renderAll());
el('filterType').addEventListener('change',()=>renderAll());
el('filterMonth').addEventListener('change',()=>renderAll());
el('clearFilters').addEventListener('click',()=>{el('search').value=''; el('filterType').value='all'; el('filterMonth').value=''; renderAll();});

el('saveBudget').addEventListener('click',()=>{state.budget=Number(el('budgetAmt').value||0); saveCurrent();});
el('addGoal').addEventListener('click',()=>{const n=el('goalName').value.trim(); const a=Number(el('goalAmt').value); if(!n||!a){alert('Enter name & amount');return;} state.goals.push({name:n,amount:a}); saveCurrent(); el('goalName').value=''; el('goalAmt').value='';});

el('setPin').addEventListener('click',()=>{
  const p=el('pinInput').value.trim(); if(!/^\d{4}$/.test(p)){alert('Enter 4 digits');return;}
  state.pinHash=btoa(p); saveCurrent(); alert('PIN saved'); el('pinInput').value='';
});

el('exportX').addEventListener('click',()=>{
  const ws=XLSX.utils.json_to_sheet(state.transactions||[]);
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,'Transactions');
  XLSX.writeFile(wb,'MoneyManager.xlsx');
});

el('importX').addEventListener('click',()=>el('importFile').click());
el('importFile').addEventListener('change',e=>{
  const f=e.target.files[0]; if(!f)return;
  const reader=new FileReader();
  reader.onload=e=>{
    const data=new Uint8Array(reader.result);
    const wb=XLSX.read(data,{type:'array'});
    const ws=wb.Sheets[wb.SheetNames[0]];
    const json=XLSX.utils.sheet_to_json(ws);
    state.transactions=json.map(x=>({id:uid(),type:x.type||'expense',amount:Number(x.amount||0),category:x.category||'',note:x.note||'',date:x.date||new Date().toISOString()}));
    saveCurrent(); alert('Imported!');
  };
  reader.readAsArrayBuffer(f);
});
</script>
</body>
</html>
